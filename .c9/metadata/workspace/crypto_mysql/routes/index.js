{"changed":true,"filter":false,"title":"index.js","tooltip":"/crypto_mysql/routes/index.js","value":"var express = require('express');\nvar router = express.Router();\nvar mysql = require('mysql');\nvar crypto = require(\"crypto\");\n\nvar pool = mysql.createPool({\n    connectionLimit: 150,\n    host: '0.0.0.0',\n    user: 'njir',\n    database: 'test'\n});\n\n/* GET home page. */\nrouter.get('/', function(req, res) {\n    res.render('index', {\n        title: 'Express'\n    });\n});\n\nrouter.post('/join', function(req, res) {\n    var id = req.body.id;\n    var pw = req.body.pw;\n    var name = req.body.name;\n    var salt = Math.round((new Date().valueOf() * Math.random())) + ''; //string화\n    var crypt_pass = crypto.createHash('sha512').update(pw + salt).digest('hex');\n\n    pool.getConnection(function(err, conn) {\n        if (err) console.error('err', err);\n        var sql = 'insert into user(id, pw, name, salt) values(?,?,?,?)';\n        var data = [id, crypt_pass, name, salt];\n        conn.query(sql, data, function(err, row) {\n            if (err) console.error('err', err);\n\n            if (row.affectedRows == 1) {\n                res.json({\n                    result: 'ok'\n                });\n            }\n            else {\n                res.json({\n                    result: 'fail'\n                });\n            }\n        });\n    });\n});\n\n\nrouter.get('/login', function(req, res) {\n    res.render('loginform', {\n        title: '로그인'\n    });\n});\n\nrouter.post('/login', function(req, res) {\n    var id = req.body.id;\n    var pw = req.body.pw;\n\n    pool.getConnection(function(err, conn) {\n        if (err) {\n            console.error('err', err);\n        }\n\n        var sql = 'select id, pw, name, salt from user where id=?';\n        var data = [id];\n\n        conn.query(sql, data, function(err, rows) {\n            if (err) {\n                console.error('err', err);\n            }\n            \n            var db_pass = rows[0].pw;\n            var salt = rows[0].salt;\n            var crypt_pass = crypto.createHash('sha512').update(pw + salt).digest('hex');\n            if (crypt_pass == db_pass) {\n                console.log('비밀번호 일치');\n                res.json({\n                    result: 'success'\n                });\n            }\n            else {\n                console.log('비밀번호 불일치');\n                res.json({\n                    result: 'fail'\n                });\n\n            }\n        });\n\n    });\n});\n\n\nmodule.exports = router;\n","undoManager":{"mark":84,"position":100,"stack":[[{"group":"doc","deltas":[{"start":{"row":72,"column":12},"end":{"row":73,"column":0},"action":"remove","lines":["",""]}]}],[{"group":"doc","deltas":[{"start":{"row":72,"column":12},"end":{"row":72,"column":16},"action":"remove","lines":["    "]}]}],[{"group":"doc","deltas":[{"start":{"row":72,"column":12},"end":{"row":72,"column":16},"action":"remove","lines":["    "]}]}],[{"group":"doc","deltas":[{"start":{"row":72,"column":12},"end":{"row":72,"column":16},"action":"remove","lines":["    "]}]}],[{"group":"doc","deltas":[{"start":{"row":74,"column":0},"end":{"row":74,"column":4},"action":"insert","lines":["    "]}]}],[{"group":"doc","deltas":[{"start":{"row":74,"column":4},"end":{"row":74,"column":8},"action":"insert","lines":["    "]}]}],[{"group":"doc","deltas":[{"start":{"row":74,"column":8},"end":{"row":74,"column":12},"action":"insert","lines":["    "]}]}],[{"group":"doc","deltas":[{"start":{"row":74,"column":12},"end":{"row":74,"column":13},"action":"insert","lines":["i"]}]}],[{"group":"doc","deltas":[{"start":{"row":74,"column":13},"end":{"row":74,"column":14},"action":"insert","lines":["f"]}]}],[{"group":"doc","deltas":[{"start":{"row":74,"column":14},"end":{"row":74,"column":16},"action":"insert","lines":["()"]}]}],[{"group":"doc","deltas":[{"start":{"row":74,"column":15},"end":{"row":74,"column":16},"action":"insert","lines":["c"]}]}],[{"group":"doc","deltas":[{"start":{"row":74,"column":16},"end":{"row":74,"column":17},"action":"insert","lines":["t"]}]}],[{"group":"doc","deltas":[{"start":{"row":74,"column":16},"end":{"row":74,"column":17},"action":"remove","lines":["t"]}]}],[{"group":"doc","deltas":[{"start":{"row":74,"column":16},"end":{"row":74,"column":17},"action":"insert","lines":["r"]}]}],[{"group":"doc","deltas":[{"start":{"row":74,"column":17},"end":{"row":74,"column":18},"action":"insert","lines":["y"]}]}],[{"group":"doc","deltas":[{"start":{"row":74,"column":15},"end":{"row":74,"column":18},"action":"remove","lines":["cry"]},{"start":{"row":74,"column":15},"end":{"row":74,"column":25},"action":"insert","lines":["crypt_pass"]}]}],[{"group":"doc","deltas":[{"start":{"row":74,"column":25},"end":{"row":74,"column":26},"action":"insert","lines":[" "]}]}],[{"group":"doc","deltas":[{"start":{"row":74,"column":26},"end":{"row":74,"column":27},"action":"insert","lines":["="]}]}],[{"group":"doc","deltas":[{"start":{"row":74,"column":27},"end":{"row":74,"column":28},"action":"insert","lines":["="]}]}],[{"group":"doc","deltas":[{"start":{"row":74,"column":28},"end":{"row":74,"column":29},"action":"insert","lines":[" "]}]}],[{"group":"doc","deltas":[{"start":{"row":74,"column":29},"end":{"row":74,"column":30},"action":"insert","lines":["d"]}]}],[{"group":"doc","deltas":[{"start":{"row":74,"column":30},"end":{"row":74,"column":31},"action":"insert","lines":["a"]}]}],[{"group":"doc","deltas":[{"start":{"row":74,"column":30},"end":{"row":74,"column":31},"action":"remove","lines":["a"]}]}],[{"group":"doc","deltas":[{"start":{"row":74,"column":30},"end":{"row":74,"column":31},"action":"insert","lines":["b"]}]}],[{"group":"doc","deltas":[{"start":{"row":74,"column":29},"end":{"row":74,"column":31},"action":"remove","lines":["db"]},{"start":{"row":74,"column":29},"end":{"row":74,"column":36},"action":"insert","lines":["db_pass"]}]}],[{"group":"doc","deltas":[{"start":{"row":74,"column":37},"end":{"row":74,"column":38},"action":"insert","lines":["{"]}]}],[{"group":"doc","deltas":[{"start":{"row":74,"column":38},"end":{"row":76,"column":13},"action":"insert","lines":["","                ","            }"]}]}],[{"group":"doc","deltas":[{"start":{"row":80,"column":0},"end":{"row":83,"column":0},"action":"remove","lines":["            res.render('/loginform', {","                title: '로그인'","            });",""]}]}],[{"group":"doc","deltas":[{"start":{"row":75,"column":16},"end":{"row":78,"column":15},"action":"insert","lines":["","            res.render('/loginform', {","                title: '로그인'","            });"]}]}],[{"group":"doc","deltas":[{"start":{"row":70,"column":0},"end":{"row":70,"column":12},"action":"remove","lines":["            "]},{"start":{"row":74,"column":14},"end":{"row":74,"column":15},"action":"insert","lines":[" "]},{"start":{"row":74,"column":38},"end":{"row":74,"column":39},"action":"insert","lines":[" "]},{"start":{"row":75,"column":0},"end":{"row":75,"column":6},"action":"remove","lines":["      "]},{"start":{"row":75,"column":0},"end":{"row":76,"column":0},"action":"insert","lines":["",""]},{"start":{"row":76,"column":4},"end":{"row":77,"column":0},"action":"remove","lines":["      ",""]},{"start":{"row":77,"column":16},"end":{"row":77,"column":20},"action":"insert","lines":["    "]},{"start":{"row":78,"column":0},"end":{"row":78,"column":4},"action":"insert","lines":["    "]}]}],[{"group":"doc","deltas":[{"start":{"row":75,"column":0},"end":{"row":75,"column":4},"action":"insert","lines":["    "]}]}],[{"group":"doc","deltas":[{"start":{"row":75,"column":4},"end":{"row":75,"column":8},"action":"insert","lines":["    "]}]}],[{"group":"doc","deltas":[{"start":{"row":75,"column":8},"end":{"row":75,"column":12},"action":"insert","lines":["    "]}]}],[{"group":"doc","deltas":[{"start":{"row":75,"column":12},"end":{"row":75,"column":16},"action":"insert","lines":["    "]}]}],[{"group":"doc","deltas":[{"start":{"row":75,"column":16},"end":{"row":75,"column":17},"action":"insert","lines":["c"]}]}],[{"group":"doc","deltas":[{"start":{"row":75,"column":17},"end":{"row":75,"column":18},"action":"insert","lines":["o"]}]}],[{"group":"doc","deltas":[{"start":{"row":75,"column":18},"end":{"row":75,"column":19},"action":"insert","lines":["n"]}]}],[{"group":"doc","deltas":[{"start":{"row":75,"column":16},"end":{"row":75,"column":19},"action":"remove","lines":["con"]},{"start":{"row":75,"column":16},"end":{"row":75,"column":23},"action":"insert","lines":["console"]}]}],[{"group":"doc","deltas":[{"start":{"row":75,"column":23},"end":{"row":75,"column":24},"action":"insert","lines":["."]}]}],[{"group":"doc","deltas":[{"start":{"row":75,"column":24},"end":{"row":75,"column":25},"action":"insert","lines":["l"]}]}],[{"group":"doc","deltas":[{"start":{"row":75,"column":25},"end":{"row":75,"column":26},"action":"insert","lines":["o"]}]}],[{"group":"doc","deltas":[{"start":{"row":75,"column":26},"end":{"row":75,"column":27},"action":"insert","lines":["g"]}]}],[{"group":"doc","deltas":[{"start":{"row":75,"column":27},"end":{"row":75,"column":29},"action":"insert","lines":["()"]}]}],[{"group":"doc","deltas":[{"start":{"row":75,"column":28},"end":{"row":75,"column":29},"action":"insert","lines":[";"]}]}],[{"group":"doc","deltas":[{"start":{"row":75,"column":28},"end":{"row":75,"column":29},"action":"remove","lines":[";"]}]}],[{"group":"doc","deltas":[{"start":{"row":75,"column":28},"end":{"row":75,"column":30},"action":"insert","lines":["''"]}]}],[{"group":"doc","deltas":[{"start":{"row":75,"column":29},"end":{"row":75,"column":30},"action":"insert","lines":["비"]}]}],[{"group":"doc","deltas":[{"start":{"row":75,"column":30},"end":{"row":75,"column":31},"action":"insert","lines":["밀"]}]}],[{"group":"doc","deltas":[{"start":{"row":75,"column":31},"end":{"row":75,"column":32},"action":"insert","lines":["번"]}]}],[{"group":"doc","deltas":[{"start":{"row":75,"column":32},"end":{"row":75,"column":33},"action":"insert","lines":["호"]}]}],[{"group":"doc","deltas":[{"start":{"row":75,"column":33},"end":{"row":75,"column":34},"action":"insert","lines":[" "]}]}],[{"group":"doc","deltas":[{"start":{"row":75,"column":34},"end":{"row":75,"column":35},"action":"insert","lines":["일"]}]}],[{"group":"doc","deltas":[{"start":{"row":75,"column":35},"end":{"row":75,"column":36},"action":"insert","lines":["치"]}]}],[{"group":"doc","deltas":[{"start":{"row":75,"column":38},"end":{"row":75,"column":39},"action":"insert","lines":[";"]}]}],[{"group":"doc","deltas":[{"start":{"row":79,"column":13},"end":{"row":80,"column":0},"action":"insert","lines":["",""]},{"start":{"row":80,"column":0},"end":{"row":80,"column":12},"action":"insert","lines":["            "]}]}],[{"group":"doc","deltas":[{"start":{"row":80,"column":12},"end":{"row":80,"column":13},"action":"insert","lines":["e"]}]}],[{"group":"doc","deltas":[{"start":{"row":80,"column":13},"end":{"row":80,"column":14},"action":"insert","lines":["l"]}]}],[{"group":"doc","deltas":[{"start":{"row":80,"column":14},"end":{"row":80,"column":15},"action":"insert","lines":["s"]}]}],[{"group":"doc","deltas":[{"start":{"row":80,"column":15},"end":{"row":80,"column":16},"action":"insert","lines":["e"]}]}],[{"group":"doc","deltas":[{"start":{"row":80,"column":16},"end":{"row":80,"column":17},"action":"insert","lines":["{"]}]}],[{"group":"doc","deltas":[{"start":{"row":80,"column":17},"end":{"row":82,"column":13},"action":"insert","lines":["","                ","            }"]}]}],[{"group":"doc","deltas":[{"start":{"row":76,"column":0},"end":{"row":77,"column":0},"action":"remove","lines":["                res.render('/loginform', {",""]}]}],[{"group":"doc","deltas":[{"start":{"row":76,"column":0},"end":{"row":77,"column":0},"action":"remove","lines":["                    title: '로그인'",""]}]}],[{"group":"doc","deltas":[{"start":{"row":76,"column":0},"end":{"row":77,"column":0},"action":"remove","lines":["                });",""]}]}],[{"group":"doc","deltas":[{"start":{"row":75,"column":39},"end":{"row":78,"column":19},"action":"insert","lines":["","                res.json({","                    result: 'fail'","                });"]}]}],[{"group":"doc","deltas":[{"start":{"row":80,"column":17},"end":{"row":83,"column":19},"action":"insert","lines":["","                res.json({","                    result: 'fail'","                });"]}]}],[{"group":"doc","deltas":[{"start":{"row":80,"column":17},"end":{"row":81,"column":39},"action":"insert","lines":["","                console.log('비밀번호 일치');"]}]}],[{"group":"doc","deltas":[{"start":{"row":77,"column":29},"end":{"row":77,"column":33},"action":"remove","lines":["fail"]}]}],[{"group":"doc","deltas":[{"start":{"row":77,"column":29},"end":{"row":77,"column":30},"action":"insert","lines":["s"]}]}],[{"group":"doc","deltas":[{"start":{"row":77,"column":30},"end":{"row":77,"column":31},"action":"insert","lines":["u"]}]}],[{"group":"doc","deltas":[{"start":{"row":77,"column":31},"end":{"row":77,"column":32},"action":"insert","lines":["e"]}]}],[{"group":"doc","deltas":[{"start":{"row":77,"column":32},"end":{"row":77,"column":33},"action":"insert","lines":["e"]}]}],[{"group":"doc","deltas":[{"start":{"row":77,"column":32},"end":{"row":77,"column":33},"action":"remove","lines":["e"]}]}],[{"group":"doc","deltas":[{"start":{"row":77,"column":31},"end":{"row":77,"column":32},"action":"remove","lines":["e"]}]}],[{"group":"doc","deltas":[{"start":{"row":77,"column":31},"end":{"row":77,"column":32},"action":"insert","lines":["c"]}]}],[{"group":"doc","deltas":[{"start":{"row":77,"column":32},"end":{"row":77,"column":33},"action":"insert","lines":["c"]}]}],[{"group":"doc","deltas":[{"start":{"row":77,"column":33},"end":{"row":77,"column":34},"action":"insert","lines":["e"]}]}],[{"group":"doc","deltas":[{"start":{"row":77,"column":34},"end":{"row":77,"column":35},"action":"insert","lines":["s"]}]}],[{"group":"doc","deltas":[{"start":{"row":77,"column":35},"end":{"row":77,"column":36},"action":"insert","lines":["s"]}]}],[{"group":"doc","deltas":[{"start":{"row":81,"column":34},"end":{"row":81,"column":35},"action":"insert","lines":["불"]}]}],[{"group":"doc","deltas":[{"start":{"row":80,"column":16},"end":{"row":80,"column":17},"action":"insert","lines":[" "]},{"start":{"row":85,"column":0},"end":{"row":85,"column":16},"action":"remove","lines":["                "]}]}],[{"group":"doc","deltas":[{"start":{"row":87,"column":0},"end":{"row":88,"column":0},"action":"remove","lines":["",""]}]}],[{"group":"doc","deltas":[{"start":{"row":87,"column":0},"end":{"row":88,"column":0},"action":"remove","lines":["",""]}]}],[{"group":"doc","deltas":[{"start":{"row":87,"column":0},"end":{"row":88,"column":0},"action":"remove","lines":["",""]}]}],[{"group":"doc","deltas":[{"start":{"row":49,"column":16},"end":{"row":49,"column":17},"action":"remove","lines":["/"]}]}],[{"group":"doc","deltas":[{"start":{"row":70,"column":0},"end":{"row":71,"column":0},"action":"remove","lines":["",""]}]}],[{"group":"doc","deltas":[{"start":{"row":69,"column":13},"end":{"row":70,"column":0},"action":"insert","lines":["",""]},{"start":{"row":70,"column":0},"end":{"row":70,"column":12},"action":"insert","lines":["            "]}]}],[{"group":"doc","deltas":[{"start":{"row":70,"column":12},"end":{"row":70,"column":13},"action":"insert","lines":["/"]}]}],[{"group":"doc","deltas":[{"start":{"row":70,"column":13},"end":{"row":70,"column":14},"action":"insert","lines":["/"]}]}],[{"group":"doc","deltas":[{"start":{"row":70,"column":14},"end":{"row":70,"column":15},"action":"insert","lines":["e"]}]}],[{"group":"doc","deltas":[{"start":{"row":70,"column":15},"end":{"row":70,"column":16},"action":"insert","lines":["l"]}]}],[{"group":"doc","deltas":[{"start":{"row":70,"column":16},"end":{"row":70,"column":17},"action":"insert","lines":["s"]}]}],[{"group":"doc","deltas":[{"start":{"row":70,"column":17},"end":{"row":70,"column":18},"action":"insert","lines":["e"]}]}],[{"group":"doc","deltas":[{"start":{"row":70,"column":17},"end":{"row":70,"column":18},"action":"remove","lines":["e"]}]}],[{"group":"doc","deltas":[{"start":{"row":70,"column":16},"end":{"row":70,"column":17},"action":"remove","lines":["s"]}]}],[{"group":"doc","deltas":[{"start":{"row":70,"column":15},"end":{"row":70,"column":16},"action":"remove","lines":["l"]}]}],[{"group":"doc","deltas":[{"start":{"row":70,"column":14},"end":{"row":70,"column":15},"action":"remove","lines":["e"]}]}],[{"group":"doc","deltas":[{"start":{"row":70,"column":13},"end":{"row":70,"column":14},"action":"remove","lines":["/"]}]}],[{"group":"doc","deltas":[{"start":{"row":70,"column":13},"end":{"row":70,"column":14},"action":"insert","lines":["/"]}]}],[{"group":"doc","deltas":[{"start":{"row":70,"column":13},"end":{"row":70,"column":14},"action":"remove","lines":["/"]}]}],[{"group":"doc","deltas":[{"start":{"row":70,"column":12},"end":{"row":70,"column":13},"action":"remove","lines":["/"]}]}]]},"ace":{"folds":[],"scrolltop":886,"scrollleft":0,"selection":{"start":{"row":73,"column":32},"end":{"row":73,"column":32},"isBackwards":false},"options":{"guessTabSize":true,"useWrapMode":false,"wrapToView":true},"firstLineState":{"row":58,"state":"start","mode":"ace/mode/javascript"}},"timestamp":1421804040203}